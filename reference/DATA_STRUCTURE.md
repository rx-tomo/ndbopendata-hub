# NDBオープンデータ プロジェクトのデータ構造について

## 重要：本プロジェクトで扱うデータの性質

### 🎯 集計済みデータであることの明確化

本プロジェクトで扱うNDBオープンデータは、**個別の患者レコードではなく、すでに集計された統計データ**です。

### データの具体例

#### Excelファイルの内容（例：BMIデータ）
```
地域: 沖縄県北部
性別: 男性
年齢階級: 40-44歳
BMI範囲: 40.0以上
人数: 19人  ← これが1つのデータポイント
```

#### データベースへの格納方法
```sql
-- health_inspection_results テーブル
INSERT INTO basic_checkup_results (
    area_name,
    gender,
    age_group,
    range_label,
    inspection_count  -- ここに「19」という集計値が入る
) VALUES (
    '北部',
    'M',
    '40-44',
    '40.0以上',
    19  -- 個別レコードではなく、集計済みの人数
);
```

### よくある誤解

❌ **誤解**: 19人分の個別データがあり、それをCOUNT(*)で集計している
✅ **正解**: すでに「19人」と集計された値が1レコードとして格納されている

### データ量の正しい理解

- **「435,333レコード」の意味**：
  - 435,333個の集計データポイント（地域×性別×年齢×項目の組み合わせ）
  - 個別の患者データではない

- **「12億回答超」の意味**：
  - 各集計レコードのinspection_count/response_countの総和
  - 延べ人数（同一人物の重複含む）

### テーブル構造の特徴

```sql
-- 個別データテーブル（本プロジェクトには存在しない）
-- CREATE TABLE patient_records (
--     patient_id INTEGER,
--     bmi_value DECIMAL,
--     ...
-- );

-- 集計データテーブル（本プロジェクトで使用）
CREATE TABLE basic_checkup_results (
    area_name VARCHAR,
    gender VARCHAR(1),
    age_group VARCHAR,
    range_label VARCHAR,
    inspection_count INTEGER,  -- 集計済みの人数
    ...
);
```

### 4点突合における理解

4点突合テストで確認しているのは：
- Excel: セルに記載された集計値（例：19）
- DB: inspection_countカラムの値（例：19）
- API: レスポンスのinspection_countフィールド（例：19）
- UI: 画面に表示される人数（例：19人）

すべて同じ「集計済みの値」を異なる層で確認しています。

### プロジェクトにおける用語の使い方

適切な表現：
- ✅ 集計データレコード
- ✅ 集計済みデータ
- ✅ 統計データ
- ✅ 延べ人数

避けるべき表現：
- ❌ 患者レコード
- ❌ 個別データ
- ❌ 生データ
- ❌ 実人数（重複排除されていない場合）
